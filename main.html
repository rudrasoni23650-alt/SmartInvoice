<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartInvoice</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    /* Custom focus styles */
    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #284ced;
      box-shadow: 0 0 2px #888;
    }

    body {
      font-family: 'Urbanist', sans-serif;
      background-image: url('windows-server-2025-3840x2160-15385.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: inherit;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -1;
      filter: brightness(0.92);
    }

    /* For popup messages */
    .success-message {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }
  </style>
</head>
<body class="min-h-screen text-gray-900">

  <!-- ===========================
  ============================ -->
  <div id="customLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="w-full max-w-md bg-white rounded-xl shadow-xl p-8 relative flex flex-col items-center space-y-4">
      <!-- Heading -->
      <h2 class="text-3xl font-semibold text-blue-600 mb-4">Welcome back!</h2>
      
      <!-- Email & Password input fields -->
      <div class="w-full space-y-3 mb-4">
        <input type="email" id="emailInput" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none" />
        <input type="password" id="passwordInput" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none" />
        <button class="w-full bg-blue-600 text-white px-4 py-3 rounded hover:bg-blue-700" onclick="emailPasswordLogin()">Login</button>
      </div>
      
      <!-- Text above social logins -->
      <div class="w-full text-center mb-2 text-gray-600 font-semibold">Or sign in with</div>
      
      <!-- Social login options -->
      <div class="w-full space-y-3 mb-4">
        <button class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 hover:bg-gray-100 flex items-center justify-center space-x-3" onclick="signInWith('Google')">
          <img src="https://img.icons8.com/color/24/google-logo.png" alt="Google" />
          <span>Sign in with Google</span>
        </button>
        <button class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 hover:bg-gray-100 flex items-center justify-center space-x-3" onclick="signInWith('Facebook')">
          <img src="https://img.icons8.com/ios-filled/24/facebook-new.png" alt="Facebook" />
          <span>Sign in with Facebook</span>
        </button>
        <button class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 hover:bg-gray-100 flex items-center justify-center space-x-3" onclick="signInWith('Apple')">
          <img src="https://img.icons8.com/ios-filled/24/mac-os.png" alt="Apple" />
          <span>Sign in with Apple</span>
        </button>
      </div>
      
      <!-- Continue without signing -->
      <div>
        <button class="text-blue-600 font-semibold hover:underline cursor-pointer" onclick="continueWithoutSign()">Continue without signing</button>
      </div>
    </div>
  </div>

  <nav class="bg-white shadow-lg p-4 px-8 flex justify-between items-center sticky top-0 z-50 backdrop-blur-none bg-opacity-100 border-b border-gray-200">
    <div class="flex items-center gap-2 font-semibold text-xl text-blue-600">
      <img src="https://img.icons8.com/fluency/48/invoice.png" alt="Logo" class="w-6 h-6" />
      SmartInvoice
    </div>
    <div class="hidden md:flex space-x-8 text-gray-700 font-medium">
      <a href="/main.html" class="hover:text-blue-600 transition">Home</a>
      <a href="/about.html" class="hover:text-blue-600 transition">About</a>
      <a href="/pricing.html" class="hover:text-blue-600 transition">Pricing</a>
    </div>
    <div class="flex gap-3">
      <a href="/log in.html">
        <button class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition text-sm">Login</button>
      </a>
      <a href="/log in.html">
        <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300 transition text-sm">Sign Up</button>
      </a>
    </div>
  </nav>

  <!-- Header -->
  <section class="flex flex-col items-center justify-center text-center my-16 px-4">
    <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 drop-shadow-lg animate-bounce">SmartInvoice</h1>
    <p class="text-lg md:text-xl text-white drop-shadow-lg">Making invoice generation easy, fast, and professional.</p>
  </section>

  <!-- Main content -->
  <main class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
    <!-- Invoice Generator -->
    <div class="md:col-span-2 bg-white rounded-2xl shadow-xl p-8 space-y-6 border border-gray-300">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4 border-b pb-2">Seller Information</h2>
      <div class="space-y-4">
        <input type="text" id="sellerName" placeholder="Seller Name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none" />
        <textarea id="sellerAddress" placeholder="Seller Address" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3"></textarea>
        <input type="text" id="invoiceName" placeholder="Enter invoice name (optional)" class="w-full p-3 border border-gray-300 rounded-lg" />
      </div>
      
      <h2 class="text-2xl font-semibold text-blue-600 mb-4 border-b pb-2">Buyer Information</h2>
      <div class="space-y-4">
        <input type="text" id="clientName" placeholder="Buyer Name" class="w-full p-3 border border-gray-300 rounded-lg" />
        <textarea id="clientAddress" placeholder="Buyer Address" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3"></textarea>
        <input type="date" id="invoiceDate" class="w-full p-3 border border-gray-300 rounded-lg" />
        <textarea id="bankDetails" placeholder="Bank Details" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="2"></textarea>
        <select id="paymentMethod" class="w-full p-3 border border-gray-300 rounded-lg">
          <option value="Cash">üíµ Cash</option>
          <option value="UPI">üì± UPI</option>
          <option value="Credit Card">üí≥ Credit Card</option>
          <option value="Net Banking">üè¶ Net Banking</option>
        </select>
      </div>
      
      <h2 class="text-2xl font-semibold text-blue-600 mb-4 border-b pb-2">Items</h2>
      <div id="itemContainer" class="space-y-3"></div>
      <div class="flex gap-3">
        <button onclick="addItem()" class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 transition text-sm">+ Add Item</button>
        <button onclick="generateInvoice()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition font-semibold w-full text-center">Generate Invoice PDF</button>
      </div>
    </div>
    
    <!-- Invoice History -->
    <div class="w-full md:w-full bg-white rounded-xl shadow-xl p-6 max-h-[85vh] overflow-y-auto border border-gray-300">
      <h2 class="text-xl font-semibold mb-4 text-blue-600 border-b pb-2">üìÇ Invoice History</h2>
      <ul id="invoiceHistory" class="space-y-3 text-gray-700 text-sm"></ul>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center text-gray-400 text-sm py-4 mt-10">
    &copy; 2025 Smart Invoice. All rights reserved.
  </footer>

  <script>
      document.addEventListener('DOMContentLoaded', () => {
    console.log('popupShown before:', localStorage.getItem('popupShown'));
    if (!localStorage.getItem('popupShown')) {
      showLogin();
      localStorage.setItem('popupShown', 'true');
      console.log('Popup shown, setting flag.');
    } else {
      console.log('Popup already shown before.');
    }
  });console.log('popupShown:', localStorage.getItem('popupShown'));
    // Show the login modal on page load
    document.addEventListener('DOMContentLoaded', () => {
      showLogin();
    });

    // Existing code
    let invoices = [];
    const storedInvoices = localStorage.getItem('smartInvoiceHistory');
    if (storedInvoices) {
      invoices = JSON.parse(storedInvoices);
    }

    document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];

    window.addItem = function() {
      const item = document.createElement("div");
      item.className = "grid grid-cols-5 gap-2 mb-4 bg-gray-50 p-2 rounded-lg shadow-sm border border-gray-300";
      item.innerHTML = `
        <input type="text" placeholder="Item" class="col-span-2 p-2 border border-gray-300 rounded-lg focus:outline-none" />
        <input type="number" placeholder="Qty" class="p-2 border border-gray-300 rounded-lg" />
        <input type="number" placeholder="Price" class="p-2 border border-gray-300 rounded-lg" />
        <div class="flex flex-col gap-1">
          <input type="number" placeholder="Tax %" class="p-2 border border-gray-300 rounded-lg" />
          <input type="number" placeholder="Discount %" class="p-2 border border-gray-300 rounded-lg" />
        </div>
      `;
      document.getElementById("itemContainer").appendChild(item);
    };

    window.showMessage = function(message, type='success') {
      const messageDiv = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
      messageDiv.className = `success-message ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg`;
      messageDiv.innerHTML = `
        <div class="flex items-center justify-between">
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">‚úï</button>
        </div>
      `;
      document.body.appendChild(messageDiv);
      setTimeout(() => {
        if (messageDiv.parentElement) messageDiv.remove();
      }, 4000);
    };

    window.renderInvoiceHistory = function() {
      const invoiceHistory = document.getElementById("invoiceHistory");
      invoiceHistory.innerHTML = "";
      if (invoices.length === 0) {
        const li = document.createElement("li");
        li.className = "text-center py-4 text-gray-500";
        li.innerHTML = "No invoices generated yet";
        invoiceHistory.appendChild(li);
        return;
      }
      invoices.forEach((inv, i) => {
        const li = document.createElement("li");
        li.className = "flex items-center gap-3 p-3 rounded-lg hover:bg-blue-50 transition cursor-pointer";
        li.innerHTML = `
          <span class="text-xl">üìÑ</span>
          <div class="flex-1">
            <div class="font-semibold">${inv.invoiceName || inv.clientName || 'Unnamed Invoice'}</div>
            <div class="text-xs text-gray-500">${inv.dateGenerated}</div>
            <div class="text-xs text-blue-600">‚Çπ${inv.total.toFixed(2)}</div>
          </div>
        `;
        li.onclick = () => window.regenerateInvoice(inv);
        invoiceHistory.appendChild(li);
      });
    };

    window.regenerateInvoice = function(inv) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Recreate invoice PDF
      doc.setFontSize(18);
      doc.text(inv.invoiceName || "Invoice", 105, 20, { align: "center" });
      doc.setFontSize(12);
      doc.text(`Seller: ${inv.sellerName}`, 20, 35);
      doc.text(`Buyer: ${inv.clientName}`, 20, 45);
      doc.text(`Date: ${inv.invoiceDate}`, 20, 55);
      doc.text(`Payment Method: ${inv.paymentMethod}`, 20, 65);
      doc.text(`Bank Details: ${inv.bankDetails}`, 20, 75);
      let y = 85;
      let total = 0;
      inv.items.forEach(item => {
        const taxAmt = (item.rate * item.qty * item.tax) / 100;
        const discountAmt = (item.rate * item.qty * item.discount) / 100;
        const lineTotal = item.rate * item.qty + taxAmt - discountAmt;
        total += lineTotal;
        doc.text(`${item.name} x${item.qty} @${item.rate} (Tax: ${item.tax}%, Disc: ${item.discount}%) = ‚Çπ${lineTotal.toFixed(2)}`, 20, y);
        y += 10;
      });
      doc.text(`Total: ‚Çπ${total.toFixed(2)}`, 20, y);
      const filename = (inv.invoiceName || inv.clientName || 'invoice').replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
      doc.save(filename);
      window.showMessage('Invoice downloaded! üì•');
    };

    window.generateInvoice = function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Gather form data
      const sellerName = document.getElementById("sellerName").value.trim();
      const sellerAddress = document.getElementById("sellerAddress").value.trim();
      const invoiceDate = document.getElementById("invoiceDate").value || new Date().toISOString().split('T')[0];
      const paymentMethod = document.getElementById("paymentMethod").value;
      const bankDetails = document.getElementById("bankDetails").value.trim();
      const clientName = document.getElementById("clientName").value.trim();
      const clientAddress = document.getElementById("clientAddress").value.trim();
      const invoiceName = document.getElementById("invoiceName").value.trim();

      if (!sellerName) {
        showMessage('Please enter seller name!', 'error');
        document.getElementById("sellerName").focus();
        return;
      }
      if (!clientName) {
        showMessage('Please enter buyer name!', 'error');
        document.getElementById("clientName").focus();
        return;
      }

      const items = [];
      const itemRows = document.querySelectorAll("#itemContainer > div");
      itemRows.forEach((row) => {
        const inputs = row.querySelectorAll("input");
        if (inputs.length >= 5) {
          const [name, qty, rate, tax, discount] = inputs;
          const nameVal = name.value.trim();
          const qtyVal = parseFloat(qty.value) || 0;
          const rateVal = parseFloat(rate.value) || 0;
          if (nameVal && qtyVal > 0 && rateVal > 0) {
            const taxVal = parseFloat(tax.value) || 0;
            const discountVal = parseFloat(discount.value) || 0;

            const subtotal = rateVal * qtyVal;
            const discountAmount = (subtotal * discountVal) / 100;
            const taxableAmount = subtotal - discountAmount;
            const taxAmount = (taxableAmount * taxVal) / 100;
            const total = taxableAmount + taxAmount;

            items.push({
              name: nameVal,
              qty: qtyVal,
              rate: rateVal,
              discount: discountVal,
              tax: taxVal,
              total: total
            });
          }
        }
      });

      if (items.length === 0) {
        showMessage('Please add at least one valid item with name, quantity, and rate!', 'error');
        return;
      }

      let y = 20;
      doc.setFontSize(18);
      doc.text(invoiceName || "Invoice", 105, y, { align: "center" });
      y += 15;

      doc.setFontSize(12);
      doc.text("Seller:", 14, y);
      doc.text(sellerName, 14, y + 6);
      if (sellerAddress) {
        const sellerLines = doc.splitTextToSize(sellerAddress, 80);
        sellerLines.forEach((line, i) => {
          doc.text(line, 14, y + 12 + (i * 6));
        });
      }

      doc.text("Buyer:", 140, y);
      doc.text(clientName, 140, y + 6);
      if (clientAddress) {
        const clientLines = doc.splitTextToSize(clientAddress, 80);
        clientLines.forEach((line, i) => {
          doc.text(line, 140, y + 12 + (i * 6));
        });
      }

      y += 35;
      doc.text(`Date: ${invoiceDate}`, 14, y);
      y += 15;

      if (doc.autoTable) {
        doc.autoTable({
          startY: y,
          head: [["Item", "Qty", "Rate", "Discount", "Tax", "Total"]],
          body: items.map(i => [
            i.name,
            i.qty.toString(),
            `‚Çπ${i.rate.toFixed(2)}`,
            `${i.discount}%`,
            `${i.tax}%`,
            `‚Çπ${i.total.toFixed(2)}`
          ]),
          theme: 'grid',
          headStyles: { fillColor: [59, 130, 246], textColor: 255 },
          styles: { cellPadding: 3, fontSize: 10, halign: 'center' }
        });
        y = doc.lastAutoTable.finalY + 15;
      } else {
        items.forEach((item, i) => {
          doc.text(`${item.name} x${item.qty} @‚Çπ${item.rate} = ‚Çπ${item.total.toFixed(2)}`, 14, y);
          y += 8;
        });
        y += 10;
      }

      const grandTotal = items.reduce((sum, i) => sum + i.total, 0);
      doc.setFontSize(14);
      doc.text(`Total Payable: ‚Çπ${grandTotal.toFixed(2)}`, 150, y);

      if (paymentMethod) {
        doc.setFontSize(12);
        doc.text("Payment Method: " + paymentMethod, 14, y + 15);
      }

      if (bankDetails) {
        doc.text("Bank Details: " + bankDetails, 14, y + 25);
      }

      // Save to history
      const invoiceData = {
        sellerName,
        sellerAddress,
        clientName,
        clientAddress,
        invoiceDate,
        paymentMethod,
        bankDetails,
        items,
        invoiceName: invoiceName || `Invoice for ${clientName}`,
        total: grandTotal,
        dateGenerated: new Date().toLocaleDateString()
      };
      invoices.unshift(invoiceData);
      if (invoices.length > 50) invoices = invoices.slice(0, 50);
      localStorage.setItem('smartInvoiceHistory', JSON.stringify(invoices));
      renderInvoiceHistory();

      const filename = (invoiceName || `Invoice_${clientName}_${invoiceDate}`).replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
      doc.save(filename);
      showMessage('Invoice generated and downloaded! üéâ');
    };

    // =========================
    // Login modal functions
    // =========================
    function showLogin() {
      document.getElementById('customLoginModal').classList.remove('hidden');
    }
    function continueWithoutSign() {
      document.getElementById('customLoginModal').classList.add('hidden');
    }
    function signInWith(platform) {
      alert(`Signing in with ${platform} (not implemented)`);
      continueWithoutSign();
    }
    // Email/password login handler
    function emailPasswordLogin() {
      const email = document.getElementById('emailInput').value.trim();
      const password = document.getElementById('passwordInput').value.trim();
      if (email && password) {
        alert(`Logged in as ${email} (not actually implemented)`);
        continueWithoutSign(); // or hide modal
      } else {
        alert('Please enter email and password');
      }
    }
  </script>
</body>
</html>